module.exports = (bot, chatId, user, data) => {
  const showMainMenu = () => {
    bot.sendMessage(
      chatId,
      "<b>‚ùì To Get Basic BJS Codes.. Tap Following Buttons or Type Bas, Bas2, Bas3, Bas4, Bas5</b>",
      {
        parse_mode: "HTML",
        disable_web_page_preview: true,
        reply_markup: {
          inline_keyboard: [
            [{ text: "üëãüèª Set Of BB Codes Part 1", callback_data: "bas" }],
            [{ text: "üëãüèª Set Of BB Codes Part 2", callback_data: "bas2" }],
            [{ text: "üëãüèª Set Of BB Codes Part 3", callback_data: "bas3" }],
            [{ text: "üëãüèª Set Of BB Codes Part 4", callback_data: "bas4" }],
            [{ text: "üëãüèª Set Of BB Codes Part 5", callback_data: "bas5" }],
            [{ text: "‚ù§Ô∏è Get Bots.business GPT AI", callback_data: "ai" }],
            [{ text: "üõë How To Get Bot Token", callback_data: "howtobottoken" }]
          ]
        }
      }
    );
  };

  const snippets = {
    bas: {
      text: `üõ† *Bots.Business Basic Codes Cheat Sheet*
Think of this as your BB survival kit ‚Äî the 'must-know' codes to get things done.
No async, no fancy stuff ‚Äî just working basics.

1Ô∏è‚É£ *Send a Message*
üì¢ Say something to the user.
\`\`\`
Bot.sendMessage("Hello! Welcome to my bot ü§ñ");
\`\`\`

2Ô∏è‚É£ *Send a Keyboard*
üéØ Let users choose buttons instead of typing.
\`\`\`
Bot.sendKeyboard(
  "Option 1, Option 2",
  "Choose one:"
);
\`\`\`

3Ô∏è‚É£ *Send an Inline Keyboard*
üîó Clickable buttons under your message.
\`\`\`
Api.sendMessage({
  text: "Click a button:",
  reply_markup: {
    inline_keyboard: [
      [{ text: "Google", url: "https://google.com" }],
      [{ text: "Next", callback_data: "next_step" }]
    ]
  }
});
\`\`\`

4Ô∏è‚É£ *Save Data*
üíæ Remember something about the user.
\`\`\`
User.setProperty("name", "Alex", "string");
\`\`\`

5Ô∏è‚É£ *Get Saved Data*
üìÇ Read what you saved before.
\`\`\`
let name = User.getProperty("name");
Bot.sendMessage("Your name is: " + name);
\`\`\`

6Ô∏è‚É£ *Conditional Check*
‚öñÔ∏è Do something only if a condition is true.
\`\`\`
let coins = User.getProperty("coins");
if (coins >= 10) {
  Bot.sendMessage("You have enough coins!");
} else {
  Bot.sendMessage("Not enough coins üò¢");
}
\`\`\`

7Ô∏è‚É£ *Call Another Command*
üìû Jump to another bot command.
\`\`\`
Bot.runCommand("/start");
\`\`\`

8Ô∏è‚É£ *Work with Variables*
üßÆ Store something temporarily.
\`\`\`
let score = 5;
score = score + 1;
Bot.sendMessage("Score: " + score);
\`\`\`

9Ô∏è‚É£ *Send a Photo*
üì∑ Share an image.
\`\`\`
Api.sendPhoto({
  photo: "https://example.com/photo.jpg",
  caption: "Nice view!"
});
\`\`\`

üîü *HTTP Request (Get Data from Web)*
üåê Fetch something from the internet.
\`\`\`
HTTP.get({
  url: "https://api.example.com/data",
  success: "/onSuccess",
  error: "/onError"
});
\`\`\``,
      parse: "Markdown"
    },

    bas2: {
      text: `üöÄ *BB Basic Codes ‚Äì Part 2*

11Ô∏è‚É£ *Store a List*
\`\`\`
let list = User.getProperty("myList");
if (!list) list = [];
list.push("New Item");
User.setProperty("myList", list, "json");
Bot.sendMessage("Item added!");
\`\`\`

12Ô∏è‚É£ *Show a List*
\`\`\`
let list = User.getProperty("myList");
if (list && list.length > 0) {
  Bot.sendMessage("Your list:\\n" + list.join("\\n"));
} else {
  Bot.sendMessage("Your list is empty.");
}
\`\`\`

13Ô∏è‚É£ *Cooldown (Delay Between Actions)*
\`\`\`
let cooldown = Libs.CooldownLib;
if (cooldown.isInCooldown("myAction", 60)) {
  Bot.sendMessage("‚è≥ Wait before doing this again!");
  return;
}
cooldown.setCooldown("myAction", 60);
Bot.sendMessage("‚úÖ Action done!");
\`\`\`

14Ô∏è‚É£ *Leaderboard (Top Scores)*
\`\`\`
Libs.TopBoardLib.addUser({
  name: user.first_name,
  score: 50,
  board: "scores"
});
let top = Libs.TopBoardLib.getTopList("scores", 10);
Bot.sendMessage("üèÜ Top Players:\\n" + top);
\`\`\`

15Ô∏è‚É£ *Random Pick*
\`\`\`
let items = ["Apple", "Banana", "Cherry"];
let choice = Libs.Random.randomOneFrom(items);
Bot.sendMessage("You got: " + choice);
\`\`\`

16Ô∏è‚É£ *Basic Payment*
\`\`\`
Libs.CoinPayments.createTransaction({
  currency1: "USD",
  currency2: "BTC",
  amount: 5,
  success: "/onPaymentSuccess"
});
\`\`\`

17Ô∏è‚É£ *Run After Delay*
\`\`\`
Bot.run({
  command: "/reminder",
  run_after: 3600,
  options: { text: "Drink water!" }
});
\`\`\`

18Ô∏è‚É£ *Handle Callback Data*
\`\`\`
if (request.data == "next_step") {
  Bot.sendMessage("You clicked Next!");
}
\`\`\``,
      parse: "Markdown"
    },

    bas3: {
      text: `üß† *BB Basic Codes ‚Äì Part 3*

19Ô∏è‚É£ *Track New Users*
\`\`\`
if (!User.getProperty("started")) {
  User.setProperty("started", true, "boolean");
  Bot.sendMessage("üëã Welcome! You are now registered.");
}
\`\`\`

20Ô∏è‚É£ *Save and Use Global Data*
\`\`\`
Bot.setProperty("totalUsers", 100, "integer");
let total = Bot.getProperty("totalUsers");
Bot.sendMessage("Total users: " + total);
\`\`\`

21Ô∏è‚É£ *Language Support*
\`\`\`
Libs.Lang.add({
  en: { hello: "Hello!" },
  es: { hello: "¬°Hola!" }
});
Bot.sendMessage(Libs.Lang.t("hello"));
\`\`\`

22Ô∏è‚É£ *Guard Commands (Access Control)*
\`\`\`
Libs.GuardLib.onlyBotAdmins();
Bot.sendMessage("You are an admin!");
\`\`\`

23Ô∏è‚É£ *Date and Time Formatting*
\`\`\`
let date = new Date();
let formatted = Libs.DateTimeFormat.format(date, "dd/mm/yyyy HH:MM");
Bot.sendMessage("Current time: " + formatted);
\`\`\`

24Ô∏è‚É£ *Referral System*
\`\`\`
Libs.ReferralLib.currentUser.track({
  onA: "/onReferrerJoined"
});
\`\`\`

25Ô∏è‚É£ *Google Sheet Logging*
\`\`\`
Libs.GoogleTableSync.writeRow({
  sheet_name: "Logs",
  values: [user.telegramid, "Joined", Date.now()]
});
\`\`\`

26Ô∏è‚É£ *Webhook Listener*
\`\`\`
Libs.WebhooksLib.addWebhook({
  name: "myWebhook",
  url: "https://example.com/hook"
});
\`\`\`

27Ô∏è‚É£ *Encrypt & Decrypt Data*
\`\`\`
let encrypted = Libs.CryptoJS.encrypt("secret123", "password");
let decrypted = Libs.CryptoJS.decrypt(encrypted, "password");
Bot.sendMessage("Decrypted: " + decrypted);
\`\`\``,
      parse: "Markdown"
    },

    bas4: {
      text: `üéØ *BB Basic Codes ‚Äì Part 4: Mini Projects*

28Ô∏è‚É£ *Simple Quiz Bot*
\`\`\`
// /start command
Bot.sendMessage("What is 2 + 2?");
Bot.runCommand("/checkAnswer");

// /checkAnswer command
if (message == "4") {
  Bot.sendMessage("‚úÖ Correct!");
} else {
  Bot.sendMessage("‚ùå Wrong! The answer was 4.");
\`\`\`

29Ô∏è‚É£ *Shop Bot (Virtual Items)*
\`\`\`
// /buy command
let coins = User.getProperty("coins") || 0;
if (coins >= 10) {
  coins -= 10;
  User.setProperty("coins", coins, "integer");
  Bot.sendMessage("üéÅ You bought an item!");
} else {
  Bot.sendMessage("Not enough coins. You need 10.");
\`\`\`

30Ô∏è‚É£ *Referral Reward Bot*
\`\`\`
// /start command
let referrer = Libs.ReferralLib.currentUser.referrer;
if (referrer) {
  let coins = referrer.getProperty("coins") || 0;
  coins += 5;
  referrer.setProperty("coins", coins, "integer");
  Bot.sendMessageToChatWithId(referrer.telegramid, "üéâ You got 5 coins from referral!");
\`\`\`

31Ô∏è‚É£ *Daily Reward Bot*
\`\`\`
let cooldown = Libs.CooldownLib;
if (cooldown.isInCooldown("daily", 86400)) {
  Bot.sendMessage("‚è≥ Come back tomorrow!");
} else {
  cooldown.setCooldown("daily", 86400);
  let coins = User.getProperty("coins") || 0;
  coins += 5;
  User.setProperty("coins", coins, "integer");
  Bot.sendMessage("‚úÖ You claimed 5 coins!");
\`\`\`

32Ô∏è‚É£ *Feedback Collector Bot*
\`\`\`
let feedbacks = Bot.getProperty("feedbacks") || [];
feedbacks.push({ id: user.telegramid, text: message });
Bot.setProperty("feedbacks", feedbacks, "json");
Bot.sendMessage("‚úÖ Thanks for your feedback!");
\`\`\`

33Ô∏è‚É£ *Random Winner Selector*
\`\`\`
let participants = Bot.getProperty("participants") || [];
let winner = Libs.Random.randomOneFrom(participants);
Bot.sendMessage("üéâ The winner is: " + winner);
\`\`\`

34Ô∏è‚É£ *Simple Poll Bot*
\`\`\`
if (!User.getProperty("voted")) {
  User.setProperty("voted", true, "boolean");
  let votes = Bot.getProperty("votes") || { yes: 0, no: 0 };
  if (message.toLowerCase() == "yes") votes.yes++;
  else votes.no++;
  Bot.setProperty("votes", votes, "json");
  Bot.sendMessage("‚úÖ Vote recorded!");
} else {
  Bot.sendMessage("‚ö† You already voted!");
\`\`\``,
      parse: "Markdown"
    },

    bas5: {
      text: `‚ö° *BB Basic Codes ‚Äì Part 5: Advanced Utilities & Pro Tricks*
üí∞ *BB Basic Codes ‚Äì Part 6: Special Bot Types & Monetization*

35Ô∏è‚É£ *Store User Progress*
\`\`\`
User.setProperty("step", "askName", "string");
if (User.getProperty("step") == "askName") {
  Bot.sendMessage("What's your name?");
}
\`\`\`

36Ô∏è‚É£ *JSON API Parsing*
\`\`\`
HTTP.get({
  url: "https://api.example.com/user/123",
  success: "/parseUser"
});

// /parseUser command
let data = JSON.parse(content);
Bot.sendMessage("User name: " + data.name);
\`\`\`

37Ô∏è‚É£ *Store Complex Objects*
\`\`\`
let profile = { name: "Alex", coins: 15, level: 3 };
User.setProperty("profile", profile, "json");
\`\`\`

38Ô∏è‚É£ *Multi-Step Conversation*
\`\`\`
User.setProperty("step", "askEmail", "string");

// In another command:
if (User.getProperty("step") == "askEmail") {
  User.setProperty("email", message, "string");
  User.setProperty("step", "", "string");
  Bot.sendMessage("‚úÖ Email saved!");
}
\`\`\`

39Ô∏è‚É£ *Send Audio*
\`\`\`
Api.sendAudio({
  audio: "https://example.com/song.mp3",
  caption: "üé∂ Enjoy!"
});
\`\`\`

40Ô∏è‚É£ *Delete a Message*
\`\`\`
Api.deleteMessage({
  chat_id: chat.chatid,
  message_id: request.message.message_id
});
\`\`\`

41Ô∏è‚É£ *Use BB Options in Callbacks*
\`\`\`
Api.getUserProfilePhotos({
  user_id: user.telegramid,
  on_result: "/showProfile",
  bb_options: { custom: "data123" }
});
\`\`\`

42Ô∏è‚É£ *Subscription-Based Bot*
\`\`\`
let active = User.getProperty("sub_active");
if (!active) {
  Bot.sendMessage("‚ùå You need a subscription.");
  return;
}
Bot.sendMessage("‚úÖ Access granted!");
\`\`\`

43Ô∏è‚É£ *Time-Limited Access*
\`\`\`
let expire = User.getProperty("expire_time");
if (Date.now() > expire) {
  Bot.sendMessage("‚è≥ Your access expired.");
} else {
  Bot.sendMessage("‚úÖ You still have access!");
}
\`\`\`

44Ô∏è‚É£ *Sell Digital Files*
\`\`\`
Api.sendDocument({
  document: "https://example.com/paidfile.pdf",
  caption: "Thanks for your payment!"
});
\`\`\`

45Ô∏è‚É£ *Ad Rotator*
\`\`\`
let ads = ["Ad 1", "Ad 2", "Ad 3"];
Bot.sendMessage(Libs.Random.randomOneFrom(ads));
\`\`\`

46Ô∏è‚É£ *VIP Group Access*
\`\`\`
Bot.sendMessage("Join here: https://t.me/joinchat/example");
\`\`\`

47Ô∏è‚É£ *Sell Bot Commands*
\`\`\`
if (!User.getProperty("bought_pro")) {
  Bot.sendMessage("Buy Pro to use this command.");
  return;
}
Bot.sendMessage("Pro command activated!");
\`\`\`

48Ô∏è‚É£ *Affiliate Link Tracking*
\`\`\`
let clicks = Bot.getProperty("linkClicks") || 0;
clicks++;
Bot.setProperty("linkClicks", clicks, "integer");
Bot.sendMessage("Total clicks: " + clicks);
\`\`\``,
      parse: "Markdown"
    },

    ai: {
      text: "‚û°Ô∏è Try BB AI on Chat GPT\n‚õì Link: https://chat.openai.com/g/g-mW7CZYp2i-bb-ai-help\nüßë‚Äçüíª Improve your coding!",
      parse: "Markdown"
    },

    howtobottoken: {
      text: `<b>‚úÖ How to get your Bot Token ‚Äî Step-by-step</b>\n\n<b>1Ô∏è‚É£ Step 1 ‚Äî Talk to BotFather in Telegram</b>\n1. Open your Telegram app (mobile or desktop). üì±\n2. Search for <b>@BotFather</b> ‚Äî the official Telegram bot for creating bots. ü§ñ\n3. Start a chat with BotFather.\n\n<b>2Ô∏è‚É£ Step 2 ‚Äî Create a New Bot</b>\n1. In the BotFather chat, type: <b>/newbot</b>\n2. BotFather will ask you for:\n   ‚Ä¢ <b>Bot name</b> ‚Äî shown to users (anything you like) ‚ú®\n   ‚Ä¢ <b>Bot username</b> ‚Äî must be unique and end with <b>bot</b> (e.g., <b>my_cool_bot</b>) üî§\n\n<b>3Ô∏è‚É£ Step 3 ‚Äî Get Your Bot Token</b>\n1. After creation, BotFather will send a message like:\n<code>Use this token to access the HTTP API:\n123456789:ABCdefGhIjkLmNoPQRstuVWxyZ</code>\n2. Copy that token and keep it safe ‚Äî you‚Äôll paste it into Bots.Business üîê\n\n<b>4Ô∏è‚É£ Step 4 ‚Äî Put the Token into Bots.Business</b>\n1. Log in to Bots.Business üåê\n2. Open your bot‚Äôs <b>Settings</b> ‚öôÔ∏è\n3. Paste the token into the <b>Bot Token</b> field and save ‚úÖ\n\n<b>5Ô∏è‚É£ Step 5 ‚Äî Test the Bot</b>\n1. In Telegram, search for your bot by username (e.g., <b>@my_cool_bot</b>) üîç\n2. Click <b>Start</b> ‚ñ∂Ô∏è ‚Äî if you see this message, the bot is connected and working üéâ`,
      parse: "HTML"
    }
  };

    const key = (data || "").trim().toLowerCase();

    if (!key || key === "menu") {
        return showMainMenu();
    }

    if (snippets[key]) {
        const replyOptions = {
            parse_mode: snippets[key].parse,
            disable_web_page_preview: true,
            reply_markup: {
                inline_keyboard: [
                    [{ text: "üîô Back to Menu", callback_data: "menu" }]
                ]
            }
        };

        // Remove Back button specifically for howtobottoken
        if (key === "howtobottoken") {
            delete replyOptions.reply_markup;
        }

        bot.sendMessage(chatId, snippets[key].text, replyOptions);
    } else {
        bot.sendMessage(chatId, "‚ùå Command not recognized inside learn.", {
            reply_markup: {
                inline_keyboard: [
                    [{ text: "üîô Back to Menu", callback_data: "menu" }]
                ]
            }
        });
    }
};
